<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let Me Cook</title>
    <style>
        /* Grundlegende Stile */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        #tray {
            width: 70%;
            height: 150px;
            background-color: #ddd;
            border: 2px solid darkgray;
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .customer {
            border: 1px solid #ccc;
            background-color: #fff;
            padding: 10px;
            margin: 10px;
        }
        .item {
            width: 50px;
            height: 50px;
            background-color: #4CAF50;
            margin: 5px;
            cursor: grab;
            background-size: cover;
        }
        .stove, .fryer, .warmer {
            width: 60px;
            height: 60px;
            border: 2px solid #333;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 5px;
        }
        .warmer {
            background-color: lightgoldenrodyellow;
        }
        .stove, .fryer {
            background-color: lightblue;
        }
    </style>
</head>
<body>

    <h1>Let Me Cook</h1>

    <div id="tray" ondrop="drop(event)" ondragover="allowDrop(event)"></div>

    <div class="customer" data-order="Burger">
        <p>Kunde 1</p>
        <p>Bestellung: Burger</p>
    </div>
    <div class="customer" data-order="Mischsalat">
        <p>Kunde 2</p>
        <p>Bestellung: Mischsalat</p>
    </div>
    <div class="customer" data-order="Sandwich">
        <p>Kunde 3</p>
        <p>Bestellung: Sandwich</p>
    </div>

    <div class="stove" ondrop="dropStove(event)" ondragover="allowDrop(event)">Herd</div>
    <div class="fryer" ondrop="dropFryer(event)" ondragover="allowDrop(event)">Friteuse</div>
    <div class="warmer" ondrop="dropDish(event)" ondragover="allowDrop(event)"></div>
    <div class="warmer" ondrop="dropDish(event)" ondragover="allowDrop(event)"></div>
    <div class="warmer" ondrop="dropDish(event)" ondragover="allowDrop(event)"></div>

    <div id="ingredients">
        <div id="rindfleisch_patty" class="item" draggable="true" ondragstart="drag(event)" style="background-image: url('rindfleisch_patty.png')">Rindfleisch Patty</div>
        <div id="gemuese_patty" class="item" draggable="true" ondragstart="drag(event)" style="background-image: url('gemuese_patty.png')">Gemüse Patty</div>
        <div id="pommes" class="item" draggable="true" ondragstart="drag(event)" style="background-image: url('pommes.png')">Pommes</div>
        <div id="brötchen" class="item" draggable="true" ondragstart="drag(event)" style="background-image: url('broetchen.png')">Brötchen</div>
        <div id="salat" class="item" draggable="true" ondragstart="drag(event)" style="background-image: url('salat.png')">Salat</div>
        <div id="tomate" class="item" draggable="true" ondragstart="drag(event)" style="background-image: url('tomate.png')">Tomate</div>
        <div id="schinken" class="item" draggable="true" ondragstart="drag(event)" style="background-image: url('schinken.png')">Schinken</div>
        <div id="kaese" class="item" draggable="true" ondragstart="drag(event)" style="background-image: url('kaese.png')">Käse</div>
    </div>

    <button onclick="prepareDish()">Zubereiten</button>

    <script>
        const recipes = {
            "Burger": ["rindfleisch_patty_fertig", "brötchen", "salat", "tomate"],
            "Mischsalat": ["salat", "tomate", "gurke"],
            "Sandwich": ["brötchen", "schinken", "käse"],
            "Hotdog": ["hotdog_broetchen", "wurst_fertig", "currysauce"],
        };

        let preparationTimers = {};

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const item = document.getElementById(data);
            ev.target.appendChild(item);
        }

        function dropStove(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const item = document.getElementById(data);

            if (item.id === "rindfleisch_patty" || item.id === "gemuese_patty") {
                ev.target.appendChild(item);
                startPreparation(ev.target, item);
            }
        }

        function dropFryer(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const item = document.getElementById(data);

            if (item.id === "pommes") {
                ev.target.appendChild(item);
                startPreparation(ev.target, item);
            }
        }

        function startPreparation(station, item) {
            const timerId = setTimeout(() => {
                const finishedItemId = item.id + "_fertig";
                const finishedItem = document.createElement("div");
                finishedItem.id = finishedItemId;
                finishedItem.className = "item";
                finishedItem.draggable = true;
                finishedItem.ondragstart = drag;
                finishedItem.style.backgroundImage = `url('${finishedItemId}.png')`;

                // Überprüfen, wo die fertige Zutat platziert werden kann
                const warmers = document.querySelectorAll('.warmer');
                let placed = false;
                for (let warmer of warmers) {
                    if (!warmer.firstChild) { // Wenn der Wärmer leer ist
                        warmer.appendChild(finishedItem);
                        placed = true;
                        break; // Wenn platziert, beende die Schleife
                    }
                }

                if (!placed) {
                    console.log(`${finishedItemId} konnte nicht platziert werden, wird gelöscht.`);
                }

                // Alte Zutat entfernen
                station.removeChild(item);
                clearPreparationTimer(station);
            }, 5000); // 5 Sekunden für die Zubereitung

            // Timer speichern, um ihn später abzubrechen, wenn nötig
            preparationTimers[station.id] = timerId;
        }

        function clearPreparationTimer(station) {
            if (preparationTimers[station.id]) {
                clearTimeout(preparationTimers[station.id]);
                delete preparationTimers[station.id];
            }
        }

        function dropDish(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            ev.target.appendChild(document.getElementById(data));
        }

        function prepareDish() {
            const tray = document.getElementById("tray");
            const itemsInTray = Array.from(tray.children).map(item => item.id);

            const customers = document.querySelectorAll('.customer');
            customers.forEach(customer => {
                const order = customer.dataset.order;
                if (JSON.stringify(itemsInTray) === JSON.stringify(recipes[order])) {
                    console.log(`${customer.innerText} hat das Gericht erhalten: ${order}`);
                    customer.remove(); // Kunde verlässt
                    tray.innerHTML = ""; // Tablett leeren
                } else {
                    console.log(`Bestellung von ${customer.innerText} stimmt nicht überein.`);
                }
            });
        }
    </script>

</body>
</html>
